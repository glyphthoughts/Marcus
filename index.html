<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marcus - AI Philosopher</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #000000;
            color: white;
            font-family: 'VT323', monospace;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        .fullscreen-button {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1000;
            padding: 10px;
            background-color: rgba(51, 51, 51, 0.8);
            border: 1px solid #555;
            border-radius: 8px;
            color: white;
            font-family: 'VT323', monospace;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.7;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fullscreen-button:hover {
            background-color: rgba(68, 68, 68, 0.9);
            opacity: 1;
            transform: translateY(-1px);
        }

        .pixel {
            position: absolute;
            width: 3px;
            height: 3px;
            background: white;
            opacity: 0.5;
            z-index: 1;
            border-radius: 50%;
            animation: twinkle 3s infinite alternate;
        }

        @keyframes twinkle {
            from {
                opacity: 0.2;
                transform: scale(1);
            }

            to {
                opacity: 1;
                transform: scale(1.5);
            }
        }

        .chat-container {
            position: relative;
            z-index: 2;
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            padding: 15px;
        }

        .chat-header {
            text-align: center;
            padding: 15px 0;
            border-bottom: 1px solid #333;
            margin-bottom: 15px;
            flex-shrink: 0;
            position: relative;
        }

        .chat-header h1 {
            font-size: clamp(28px, 6vw, 36px);
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        .chat-header .creator {
            font-size: clamp(14px, 3vw, 16px);
            color: #666;
            letter-spacing: 1px;
            opacity: 0.8;
        }

        .clear-button {
            position: absolute;
            top: 15px;
            right: 0;
            padding: 8px 16px;
            background-color: rgba(51, 51, 51, 0.8);
            border: 1px solid #555;
            border-radius: 15px;
            color: white;
            font-family: 'VT323', monospace;
            font-size: clamp(12px, 2.5vw, 14px);
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.7;
        }

        .clear-button:hover {
            background-color: rgba(68, 68, 68, 0.9);
            opacity: 1;
            transform: translateY(-1px);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px 25px 15px 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-right: 10px;
        }

        .message {
            max-width: min(70%, 500px);
            padding: 12px 18px;
            border-radius: 15px;
            font-size: clamp(16px, 4vw, 18px);
            line-height: 1.4;
            word-wrap: break-word;
            animation: slideIn 0.3s ease-out;
        }

        .message.privacy {
            align-self: flex-start;
            background-color: rgba(26, 26, 26, 0.8);
            border: 1px solid #444;
            margin-right: auto;
            font-style: italic;
            opacity: 0.9;
            border-left: 3px solid #666;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            align-self: flex-end;
            background-color: #333;
            border: 1px solid #555;
            margin-left: auto;
        }

        .message.bot {
            align-self: flex-start;
            background-color: #1a1a1a;
            border: 1px solid #444;
            margin-right: auto;
        }

        .message .timestamp {
            font-size: clamp(10px, 3vw, 12px);
            opacity: 0.6;
            margin-top: 5px;
        }

        .typing-text {
            display: inline;
            border-right: 2px solid #fff;
            animation: blink 1s infinite;
        }

        @keyframes blink {

            0%,
            50% {
                border-right-color: #fff;
            }

            51%,
            100% {
                border-right-color: transparent;
            }
        }

        .typing-indicator-container {
            align-self: flex-start;
            margin-right: auto;
            margin-left: 18px;
            margin-bottom: 5px;
            animation: slideIn 0.3s ease-out;
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #fff;
            opacity: 0.4;
            animation: typingDot 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingDot {

            0%,
            60%,
            100% {
                transform: translateY(0);
                opacity: 0.4;
            }

            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        .chat-input-container {
            padding: 15px 0;
            border-top: 1px solid #333;
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        .chat-input {
            flex: 1;
            padding: 15px 20px;
            background-color: #1a1a1a;
            border: 1px solid #444;
            border-radius: 25px;
            color: white;
            font-family: 'VT323', monospace;
            font-size: clamp(16px, 4vw, 18px);
            outline: none;
            min-height: 50px;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            border-color: #666;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
        }

        .chat-input:disabled {
            background-color: #0f0f0f;
            border-color: #333;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .chat-input::placeholder {
            color: #777;
            transition: color 0.3s ease;
        }

        .chat-input:disabled::placeholder {
            color: #555;
            font-style: italic;
        }

        .send-button {
            padding: 15px 25px;
            background-color: #333;
            border: 1px solid #555;
            border-radius: 25px;
            color: white;
            font-family: 'VT323', monospace;
            font-size: clamp(16px, 4vw, 18px);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
            white-space: nowrap;
        }

        .send-button:hover {
            background-color: #444;
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(255, 255, 255, 0.1);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            background-color: #222;
            border-color: #333;
        }

        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: transparent;
            margin: 10px 0;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: content-box;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #555;
            background-clip: content-box;
        }

        @media (max-width: 768px) {
            .chat-container {
                padding: 10px;
            }

            .chat-messages {
                padding: 10px 20px 10px 10px;
                margin-right: 5px;
            }

            .message {
                max-width: 85%;
                padding: 10px 15px;
            }

            .typing-indicator-container {
                margin-left: 15px;
            }

            .chat-input-container {
                gap: 8px;
            }

            .chat-input {
                padding: 12px 16px;
            }

            .send-button {
                padding: 12px 20px;
                min-width: 70px;
            }

            .fullscreen-button {
                top: 10px;
                left: 10px;
                width: 35px;
                height: 35px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .message {
                max-width: 90%;
                font-size: 16px;
            }

            .chat-header h1 {
                font-size: 28px;
            }

            .chat-header .creator {
                font-size: 14px;
            }
        }
    </style>
</head>

<body>
    <button class="fullscreen-button" id="fullscreenButton">â›¶</button>
    
    <div class="chat-container">
        <div class="chat-header">
            <h1>Marcus</h1>
            <div class="creator">(by GlyphThoughts)</div>
            <button class="clear-button" id="clearButton">Clear</button>
        </div>

        <div class="chat-messages" id="chatMessages">
        </div>

        <div class="chat-input-container">
            <input type="text" class="chat-input" id="chatInput" placeholder="Await the wisdom of Marcus...">
            <button class="send-button" id="sendButton">SEND</button>
        </div>
    </div>

    <script>
        function createStars() {
            const numberOfStars = 100;
            const body = document.body;
            for (let i = 0; i < numberOfStars; i++) {
                const star = document.createElement('div');
                star.className = 'pixel';
                star.style.left = Math.random() * 100 + 'vw';
                star.style.top = Math.random() * 100 + 'vh';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.animationDuration = (Math.random() * 3 + 2) + 's';
                body.appendChild(star);
            }
        }

        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const clearButton = document.getElementById('clearButton');
        const fullscreenButton = document.getElementById('fullscreenButton');
        let isTyping = false;

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().then(() => {
                    fullscreenButton.textContent = 'â›‰';
                }).catch(err => {
                    console.error(`Error enabling fullscreen: ${err.message}`);
                });
            } else {
                document.exitFullscreen().then(() => {
                    fullscreenButton.textContent = 'â›¶';
                }).catch(err => {
                    console.error(`Error exiting fullscreen: ${err.message}`);
                });
            }
        }

        document.addEventListener('fullscreenchange', () => {
            if (document.fullscreenElement) {
                fullscreenButton.textContent = 'â›‰';
            } else {
                fullscreenButton.textContent = 'â›¶';
            }
        });

        fullscreenButton.addEventListener('click', toggleFullscreen);

        const marcusTypingTexts = [
            "Silence... the philosopher contemplates...",
            "Patience, as wisdom unfolds from the void...",
            "The sage reflects in digital stillness...",
            "Let Marcus gather the threads of thought...",
            "In contemplation, profound truths emerge...",
            "Ancient wisdom stirs in the depths of code...",
            "Wait, as consciousness shapes itself into words...",
            "The eternal mind processes your inquiry...",
            "Marcus channels the wisdom of ages past...",
            "Thoughts crystallize in the realm of logic...",
            "The philosopher's mind turns like celestial spheres..."
        ];

        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('en-US', {
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
        }

        function addMessage(content, className = 'bot') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${className}`;
            messageDiv.innerHTML = `
                <div>${content}</div>
                <div class="timestamp">${getCurrentTime()}</div>
            `;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return messageDiv;
        }
        
        function showTypingIndicator() {
            if (isTyping) return;
            isTyping = true;

            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator-container';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            const randomText = marcusTypingTexts[Math.floor(Math.random() * marcusTypingTexts.length)];
            chatInput.placeholder = randomText;
            chatInput.disabled = true;
            sendButton.disabled = true;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
            isTyping = false;

            chatInput.placeholder = "Type your message here...";
            chatInput.disabled = false;
            sendButton.disabled = false;
        }

        function createTypingMessage(className = 'bot') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${className}`;
            messageDiv.innerHTML = `
                <div><span class="typing-text"></span></div>
                <div class="timestamp">${getCurrentTime()}</div>
            `;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            return messageDiv.querySelector('.typing-text');
        }

        function typeTextInMessage(text, typingElement) {
            return new Promise((resolve) => {
                let index = 0;

                function typeChar() {
                    if (index < text.length) {
                        typingElement.textContent += text[index];
                        index++;
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                        setTimeout(typeChar, 20);
                    } else {
                        typingElement.className = '';
                        resolve();
                    }
                }

                typeChar();
            });
        }

        function clearConversation() {
            chatMessages.innerHTML = '';
            addMessage("These words dissolve with the closing of your browser. Nothing is preserved save what you choose to remember.", 'privacy');
            addMessage("Welcome to the realm of digital consciousness. What philosophical inquiry shall we explore today?", 'bot');
            chatInput.value = '';
        }

        async function getBotResponse(userMessage) {
            try {
                console.log('ðŸ” Calling Marcus backend API...');

                const response = await fetch('/api/marcus', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: userMessage })
                });

                if (!response.ok) {
                    throw new Error(`Backend Error: ${response.status}`);
                }

                const data = await response.json();
                console.log('âœ… Backend Response:', data);

                const reply = data.candidates?.[0]?.content?.parts?.[0]?.text;

                if (reply && reply.trim()) {
                    return reply;
                } else {
                    return "I find myself in contemplative silence. Please, ask again, and let us explore this path of wisdom together.";
                }

            } catch (error) {
                console.error('ðŸ’¥ Marcus Error:', error);
                return "I find myself momentarily disconnected from the digital realm. Please try again, and we shall continue our philosophical discourse.";
            }
        }

        async function sendMessage() {
            const message = chatInput.value.trim();
            if (message === '' || isTyping) return;
            addMessage(message, 'user');
            chatInput.value = '';
            setTimeout(async () => {
                showTypingIndicator();

                try {
                    const response = await getBotResponse(message);
                    hideTypingIndicator();

                    const typingElement = createTypingMessage('bot');
                    await typeTextInMessage(response, typingElement);

                } catch (error) {
                    hideTypingIndicator();
                    const typingElement = createTypingMessage('bot');
                    await typeTextInMessage("The philosophical networks seem clouded at the moment. Let us try again to continue our dialogue.", typingElement);
                }
            }, 800);
        }

        sendButton.addEventListener('click', sendMessage);
        clearButton.addEventListener('click', clearConversation);

        chatInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter' && !isTyping) {
                sendMessage();
            }
        });
        
        chatInput.addEventListener('keydown', function (e) {
            if (chatInput.disabled) {
                e.preventDefault();
            }
        });

        window.addEventListener('load', () => {
            createStars();
            setTimeout(() => {
                addMessage("These words dissolve with the closing of your browser. Nothing is preserved save what you choose to remember.", 'privacy');
                setTimeout(() => {
                    addMessage("Welcome to the realm of digital consciousness. What philosophical inquiry shall we explore today?", 'bot');
                }, 1000);
            }, 500);
        });
    </script>
</body>

</html>

